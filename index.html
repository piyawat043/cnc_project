<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>รายการไฟล์ STL จาก GitHub</title>
</head>
<body>
  <h1>รายการไฟล์ STL จากโปรเจกต์ CNC</h1>
  <ul id="stl-file-list"></ul>

  <script>
    const owner = 'piyawat043';        // ชื่อเจ้าของ repo
    const repo = 'cnc_project';        // ชื่อ repo
    const branch = 'main';             // สาขาที่ต้องการดึงไฟล์ (เปลี่ยนได้ถ้าใช้สาขาอื่น)

    async function fetchStlFiles() {
      // เรียกใช้ GitHub API เพื่อขอรายการไฟล์ทั้งหมดใน repo
      // โดยตั้งค่า recursive=1 เพื่อให้ได้รายการทุกโฟลเดอร์ย่อยด้วย
      const apiUrl = `https://api.github.com/repos/${owner}/${repo}/git/trees/${branch}?recursive=1`;

      try {
        const response = await fetch(apiUrl);
        const data = await response.json();

        // เมื่อได้ข้อมูลแล้ว จะอยู่ใน data.tree
        if (data.tree) {
          // คัดกรองเอาเฉพาะไฟล์ที่นามสกุล .stl
          const stlFiles = data.tree.filter(item => {
            return item.type === 'blob' && item.path.toLowerCase().endsWith('.stl');
          });

          // แสดงรายการไฟล์ .stl ในหน้าเว็บ
          const fileList = document.getElementById('stl-file-list');

          stlFiles.forEach(file => {
            const listItem = document.createElement('li');

            // สร้างลิงก์ไปดูไฟล์บน GitHub (ในหน้า blob)
            // หรือถ้าต้องการดาวน์โหลดไฟล์ดิบก็สามารถเปลี่ยนไปใช้ raw.githubusercontent.com ได้
            const fileLink = document.createElement('a');
            fileLink.href = `https://github.com/${owner}/${repo}/blob/${branch}/${file.path}`;
            fileLink.textContent = file.path;
            fileLink.target = '_blank'; // เปิดในแท็บใหม่

            listItem.appendChild(fileLink);
            fileList.appendChild(listItem);
          });

        } else {
          console.error('ไม่พบข้อมูลไฟล์ใน repository นี้');
        }

      } catch (error) {
        console.error('เกิดข้อผิดพลาดในการดึงข้อมูล:', error);
      }
    }

    // เรียกฟังก์ชันเมื่อโหลดหน้าเสร็จ
    fetchStlFiles();
  </script>
</body>
</html>
